---
title: "[PHP+MYSQL]CRUD 구현 - 1 (로그인, 회원가입)"
excerpt: "로그인, 회원가입 구현"

categories:
  - CRUD
tags:
  - [WEB, CRUD]

permalink: /CRUD/CRUD-1/

toc: true
toc_sticky: true

date: 2025-03-01
last_modified_at: 2025-03-01
---

웹 기반을 다지기 위해서 PHP, MYSQL을 이용한 CRUD 기능을 만들어 보려고 한다.   
웹해킹 공부할때 내 CRUD 웹서버를 공격해보면서 공부할 생각이다.  

우선 코드의 보안은 일절 신경 쓰지 않고 작성하였다.  
추후 웹해킹 실습을 통해 보완해 나갈 예정이다.  

---
## MYSQL DB TABLE 생성

```
CREATE USER 'admin'@'localhost' IDENTIFIED BY '7777' # admin user 생성

GRANT ALL PRIVILEGES ON *.* TO 'admin'@'localhost' WITH GRANT OPTION; # 권한 부여

# admin user로 변경 후

CREATE DATABASE user_db; # 유저 DB 생성성
USE user_db;
mysql> CREATE TABLE users (
  name VARCHAR(10) NOT NULL, # VARCHAR : 가변길이 문자열
  uid VARCHAR(30) UNIQUE NOT NULL, # UNIEQUE : 유니크한 값
  upw VARCHAR(30) NOT NULL,
  id INT AUTO_INCREMENT PRIMARY KEY
   );
```
<br>
```
DESCRIBE users; # 테이블 확인
```
**[출력]**
```
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| name  | varchar(10) | NO   |     | NULL    |                |
| uid   | varchar(30) | NO   | UNI | NULL    |                |
| upw   | varchar(30) | NO   |     | NULL    |                |
| id    | int         | NO   | PRI | NULL    | auto_increment |
+-------+-------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)
```
---

**테스트용 user 생성**
```
INSERT INTO users (name, uid, upw)
VALUES ('test', 'test123', 'test123');
```
<br>
```
SELECT * FROM users # 테이블 확인
```
**[출력]**
```
+-------+---------+---------+----+
| name  | uid     | upw     | id |
+-------+---------+---------+----+
| test  | test123 | test123 |  1 |
+-------+---------+---------+----+
1 rows in set (0.00 sec)
```
---

## PHP MYSQL 연결하기

/proc 폴더를 만들고 db.php 파일 생성

### db.php
```
<?php
$host = "localhost"; // 호스트 주소
$user = "admin";     // 사용자 이름
$pass = "7777";      // db 비밀번호
$dbname = "user_db"; // 연결할 db 이름

$conn = new mysqli($host, $user, $pass, $dbname);

if ($conn->connect_error) {
    die("DB 연결 실패: " . $conn->connect_error);
} // 했더니 작동 안함. 추후 확인.
?>
```
---
## HTML

우선 gpt를 볶아서 HTML 뼈대 제작  

### index.php
```
<?php
session_start();
?>

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/index_style.css">
    <title>zoo-log</title>
</head>

<body>

    <header>
        <h2>📝 CRUD BOARD</h2>
        <?php if (isset($_SESSION['id'])): ?> // 로그인 세션 유무 확인
                <div class="auth">
                        <a style = "font-weight : bold; color : green;"><?= htmlspecialchars($_SESSION['name']); ?></a>
                        <a href="/logout">Log out</a>
                </div>
        <?php else: ?>
                <div class="auth">
                        <a href="/login">Login</a>
                        <a href="/register">Register</a>
                </div>
        <?php endif; ?>
    </header>

    <div class="container">
        <div class="board-header">
            <h3>게시글 목록</h3>
            <a href="#" class="btn">글쓰기</a>
        </div>
        <table>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>날짜</th>
            </tr>
            <tr>
                <td>1</td>
                <td><a href="#">첫 번째 글</a></td>
                <td>홍길동</td>
                <td>03-02</td>
            </tr>
            <tr>
                <td>2</td>
                <td><a href="#">두 번째 글</a></td>
                <td>이몽룡</td>
                <td>03-01</td>
            </tr>
        </table>
    </div>

</body>

</html>
```
### register.php
```
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/login_style.css">
    <title>zoo-log</title>
</head>

<body>

    <div class="container">
        <h2>회원가입</h2>
        <form action="proc/register_proc.php" method="POST">                 
        // action : 값 보낼 경로
            <input type="name" name="name" placeholder="닉네임" required>    
            // name : 참조할 값 이름
            <input type="text" name="uid" placeholder="아이디" required>
            <input type="password" name="upw" placeholder="비밀번호" required>
            <input type="password" name="upw_check" placeholder="비밀번호 확인" required>
            <button type="submit" class="btn">가입하기</button>
        </form>
        <a href="/login">로그인</a>
    </div>

</body>

</html>
```
### login.php
```
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/login_style.css">
    <title>zoo-log</title>
</head>

<body>

    <div class="container">
        <h2>로그인</h2>
        <form action="proc/login_proc.php" method="POST">                 
        // action : 값 보낼 경로
            <input type="text" name="uid" placeholder="아이디" required>  
            // name : 참조할 값 이름
            <input type="password" name="upw" placeholder="비밀번호" required>
            <button type="submit" class="btn">로그인</button>
        </form>
        <a href="/register">회원가입</a>
    </div>

</body>

</html>
```
---
## PHP 기능 구현
### register.php
```
<?php
session_start();  // 세션
include "db.php"; // DB 연결

$name = $_POST['name'];
$uid = $_POST['uid'];
$upw = $_POST['upw'];
$upw_check = $_POST['upw_check'];

if ($upw !== $upw_check) {
        echo "<script>alert('비밀번호가 일치하지 않습니다.'); history.back();</script>";
        exit();
}

$id_check = $conn->query("SELECT uid FROM users WHERE uid = '$uid'");

if ($id_check->num_rows > 0) {
        echo "<script>alert('이미 존재하는 아이디'); history.back();</script>";
        exit();
}

$sql = "INSERT INTO users (name, uid, upw) VALUES ('$name', '$uid', '$upw')";

if ($conn->query($sql) === TRUE) {
        echo "<script>alert('회원가입 성공'); location.href='/';</script>";
}
else {
        echo "<script>alert('회원가입 실패'); history.back();</script>";
}

$conn->close(); //세션 종료

?>
```
### login.php
```
<?php
session_start();

include 'db.php';

$uid = $_POST['uid'];
$upw = $_POST['upw'];

$sql = "SELECT * FROM users WHERE uid = '$uid' AND upw = '$upw'";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
        $user = mysqli_fetch_array($result);
        // mysqli_fetch_array() : 쿼리의 결과값을 배열 형태로 가져옴
        $_SESSION['id'] = $user['id'];
        // 세션 설정
        $_SESSION['name'] = $user['name'];
        // 프로필용 이름
        echo "<script>alert('{$user['name']}님, 환영합니다.'); location.href='/';</script>";
}
else {
        echo "<script>alert('로그인 실패'); history.back();</script>";
}

$conn -> close();
?>
```
### logout.php
```
<?php
session_start();
session_destroy(); // 세션 죽이기
?>
<script>
        alert("로그아웃 되었습니다");
        location.replace('index.php');
</script>
```
---
추후 기능을 만들기 위해 최대한 PHP 문법을 이해하면서 진행하였다.